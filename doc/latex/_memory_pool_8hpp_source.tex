\doxysection{Memory\+Pool.\+hpp}
\hypertarget{_memory_pool_8hpp_source}{}\label{_memory_pool_8hpp_source}\index{include/MemoryPool.hpp@{include/MemoryPool.hpp}}
\mbox{\hyperlink{_memory_pool_8hpp}{См. документацию.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ MEMORY\_POOL\_HPP}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ MEMORY\_POOL\_HPP}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_container_macros_8hpp}{ContainerMacros.hpp}}"{}}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <cstddef>}}
\DoxyCodeLine{00006\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespace_knot}{Knot}}\ \{}
\DoxyCodeLine{00007\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_knot_1_1_memory_pool_a4f1ddabe83938cdf488e1828de404329}{MemoryPool}}\ \{}
\DoxyCodeLine{00008\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00009\ \ \ \textcolor{keywordtype}{size\_t}\ \_used\_bytes;}
\DoxyCodeLine{00010\ \ \ \textcolor{keywordtype}{size\_t}\ \_max\_bytes;}
\DoxyCodeLine{00011\ \ \ \textcolor{keywordtype}{size\_t}\ \_buffer\_offset;}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \ \ \textcolor{keywordtype}{void}\ *\_buffer;}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00016\ \ \ \mbox{\hyperlink{class_knot_1_1_memory_pool_a4f1ddabe83938cdf488e1828de404329}{MemoryPool}}(\textcolor{keywordtype}{size\_t}\ max\_bytes)}
\DoxyCodeLine{00017\ \ \ \ \ \ \ :\ \_buffer(nullptr),\ \_used\_bytes(0),\ \_max\_bytes(max\_bytes),}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \ \ \_buffer\_offset(0)\ \{\}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \ \ \mbox{\hyperlink{class_knot_1_1_memory_pool_ac2e00aa321dfe4c99783003596c0bc4a}{MemoryPool}}(\textcolor{keywordtype}{void}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ buffer\_size)}
\DoxyCodeLine{00021\ \ \ \ \ \ \ :\ \_buffer(buffer),\ \_used\_bytes(0),\ \_max\_bytes(buffer\_size),}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ \_buffer\_offset(0)\ \{\}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \ \ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{class_knot_1_1_memory_pool_acd53245eaef74aa95785ab12ba0d24ee}{allocate}}(\textcolor{keywordtype}{size\_t}\ size,\ \textcolor{keywordtype}{size\_t}\ align,\ \textcolor{keywordtype}{size\_t}\ *out\_alloc\_size\ =\ 0)\ \{}
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{keywordflow}{if}\ (size\ ==\ 0)}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_buffer)\ \{}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *base\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{char}\ *\textcolor{keyword}{>}(\_buffer)\ +\ \_buffer\_offset;}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ space\ =\ \_max\_bytes\ -\/\ \_buffer\_offset;}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ misalign\ =\ \textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(base)\ \%\ align;}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ pad\ =\ misalign\ ?\ (align\ -\/\ misalign)\ :\ 0;}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (size\ +\ pad\ >\ space)}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *ptr\ =\ base\ +\ pad;}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (out\_alloc\_size)}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ *out\_alloc\_size\ =\ size\ +\ pad;}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \_buffer\_offset\ +=\ size\ +\ pad;}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \_used\_bytes\ +=\ size\ +\ pad;}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ptr;}
\DoxyCodeLine{00042\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_used\_bytes\ +\ size\ >\ \_max\_bytes\ ||\ size\ ==\ 0)}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *ptr\ =\ \textcolor{keyword}{operator}\ \textcolor{keyword}{new}(size);}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ptr)\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (out\_alloc\_size)}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ *out\_alloc\_size\ =\ size;}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \_used\_bytes\ +=\ size;}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ptr;}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00053\ \ \ \ \ \}}
\DoxyCodeLine{00054\ \ \ \}}
\DoxyCodeLine{00055\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_knot_1_1_memory_pool_a2fba960bce74aad84dc50b8500959bae}{deallocate}}(\textcolor{keywordtype}{void}\ *ptr,\ \textcolor{keywordtype}{size\_t}\ size)\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_buffer\ ==\ \textcolor{keyword}{nullptr}\ \&\&\ ptr)\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}(ptr);}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \_used\_bytes\ -\/=\ size;}
\DoxyCodeLine{00059\ \ \ \ \ \}}
\DoxyCodeLine{00060\ \ \ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{class_knot_1_1_memory_pool_a9c6e01992942007280f938f4119e2457}{getUsedBytes}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \_used\_bytes;\ \}}
\DoxyCodeLine{00063\ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{class_knot_1_1_memory_pool_a1d86cd2a19071a65bfa395cc89c443f9}{getMaxBytes}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \_max\_bytes;\ \}}
\DoxyCodeLine{00064\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_knot_1_1_memory_pool_af9016987234046ca7b054c9f37356ade}{reset}}()\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \_used\_bytes\ =\ 0;}
\DoxyCodeLine{00066\ \ \ \ \ \_buffer\_offset\ =\ 0;}
\DoxyCodeLine{00067\ \ \ \}}
\DoxyCodeLine{00068\ \ \ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{class_knot_1_1_memory_pool_a7fb3d7851f94b1e42d156eec850780d5}{getBuffer}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \_buffer;\ \}}
\DoxyCodeLine{00069\ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{class_knot_1_1_memory_pool_a1c59c0bba77858551223215b79449c87}{getBufferOffset}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \_buffer\_offset;\ \}}
\DoxyCodeLine{00070\ \};}
\DoxyCodeLine{00071\ \}\ \textcolor{comment}{//\ namespace\ Knot}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ MEMORY\_POOL\_HPP}}

\end{DoxyCode}
